<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>tniap ðŸªž paint</title>
    <!-- Open Graph / Social Media -->
    <meta property="og:type" content="website">
    <meta property="og:title" content="tniap.com ðŸ–¼ï¸">
    <meta property="og:description" content="Paint and share your artwork">
    <meta property="og:url" content="">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="tniap.com ðŸ–¼ï¸">
    <meta name="twitter:description" content="Paint and share your artwork">
    <link rel="stylesheet" href="style.css">
    <style>
        /* Hide content by default for domains that require auth, show after auth check */
        body:not(.auth-checked):not(.no-auth-required) .app-container {
            display: none;
        }
        /* Show content immediately if no auth required class is on html element */
        html.no-auth-required .app-container {
            display: block !important;
        }
    </style>
    <script>
        // Immediate auth check before page renders
        (function() {
            function normalizeDomain(hostname) {
                return hostname.replace(/^www\./, '');
            }
            const apexDomain = normalizeDomain(window.location.hostname);
            const requiresAuth = apexDomain !== 'tniap.com';
            const pathname = window.location.pathname;
            
            // Set page title immediately
            if (apexDomain === 'tniap.com') {
                document.title = 'tniap ðŸªž paint';
            } else {
                document.title = `${apexDomain} ðŸŽ¨`;
            }
            
            function showContent() {
                // Wait for body to exist, then add class
                if (document.body) {
                    document.body.classList.add('auth-checked');
                } else {
                    document.addEventListener('DOMContentLoaded', () => {
                        document.body.classList.add('auth-checked');
                    });
                }
            }
            
            // Skip auth check for shared paintings
            if (pathname.startsWith('/paintings/')) {
                showContent();
                return;
            }
            
            // If auth not required, mark body immediately so content shows
            if (!requiresAuth) {
                // Add class as soon as body exists
                if (document.body) {
                    document.body.classList.add('no-auth-required', 'auth-checked');
                } else {
                    // Use a more immediate approach - add to documentElement
                    document.documentElement.classList.add('no-auth-required');
                    document.addEventListener('DOMContentLoaded', () => {
                        if (document.body) {
                            document.body.classList.add('no-auth-required', 'auth-checked');
                        }
                    });
                }
                return;
            }
            
            // Check auth status immediately
            fetch('/api/auth/status')
                .then(res => res.json())
                .then(data => {
                    if (data.authenticated) {
                        // Show content
                        showContent();
                    } else {
                        // Redirect immediately
                        window.location.href = '/signin.html';
                    }
                })
                .catch(() => {
                    // On error, redirect to sign-in
                    window.location.href = '/signin.html';
                });
        })();
    </script>
</head>
<body>
    <div class="app-container">
        <div class="toolbar">
            <div class="tool-group">
                <h3>Tools</h3>
                <div class="tools">
                    <button class="tool-btn active" data-tool="brush" title="Brush">
                        <img src="icons/format_paint.svg" alt="Brush" class="icon">
                    </button>
                    <button class="tool-btn" data-tool="eraser" title="Eraser">
                        <img src="icons/ink_eraser.svg" alt="Eraser" class="icon">
                    </button>
                    <button class="tool-btn" data-tool="line" title="Line">
                        <img src="icons/show_chart.svg" alt="Line" class="icon">
                    </button>
                    <button class="tool-btn" data-tool="rectangle" title="Rectangle">
                        <img src="icons/square.svg" alt="Rectangle" class="icon">
                    </button>
                    <button class="tool-btn" data-tool="circle" title="Circle">
                        <img src="icons/radio_button_unchecked.svg" alt="Circle" class="icon">
                    </button>
                    <button class="tool-btn" data-tool="fill" title="Fill">
                        <img src="icons/format_color_fill.svg" alt="Fill" class="icon">
                    </button>
                    <button class="tool-btn" data-tool="pan" title="Pan">
                        <img src="icons/pan_tool_alt.svg" alt="Pan" class="icon">
                    </button>
                </div>
            </div>
            
            <div class="tool-group">
                <h3>Size</h3>
                <input type="range" id="brushSize" min="1" max="20" value="3">
                <span id="sizeDisplay">3</span>
            </div>
            
            <div class="tool-group">
                <h3>Color</h3>
                <input type="color" id="colorPicker" value="#000000">
            </div>
            
            <div class="tool-group">
                <h3>Zoom</h3>
                <div class="zoom-controls">
                    <button id="zoomOutBtn" class="zoom-btn" title="Zoom Out">
                        <img src="icons/remove.svg" alt="Zoom Out" class="icon">
                    </button>
                    <input type="range" id="zoomSlider" min="25" max="400" value="100" step="5">
                    <button id="zoomInBtn" class="zoom-btn" title="Zoom In">
                        <img src="icons/add.svg" alt="Zoom In" class="icon">
                    </button>
                </div>
                <span id="zoomDisplay">100%</span>
            </div>
            
            <div class="tool-group">
                <button id="clearBtn" class="action-btn">Clear</button>
                <button id="saveBtn" class="action-btn">Save</button>
                <button id="shareBtn" class="action-btn">Share</button>
            </div>
            
            <div class="tool-group" id="authGroup" style="display: none;">
                <button id="logoutBtn" class="action-btn">Sign Out</button>
            </div>
        </div>
        
        <div class="canvas-container">
            <div class="canvas-wrapper" id="canvasWrapper">
                <canvas id="canvas"></canvas>
            </div>
            <div id="cursorIndicator" class="cursor-indicator"></div>
            <!-- Clear Confirmation Modal -->
            <div id="clearModal" class="modal">
                <div class="modal-content">
                    <div class="modal-body">
                        <p>Are you sure you want to clear the entire painting?</p>
                    </div>
                    <div class="modal-footer">
                        <button id="modalCancel" class="modal-btn">Cancel</button>
                        <button id="modalConfirm" class="modal-btn modal-btn-primary">Clear</button>
                    </div>
                </div>
            </div>
            <!-- Share Modal -->
            <div id="shareModal" class="modal">
                <div class="modal-content">
                    <div class="modal-body">
                        <p id="shareStatus">ðŸŽ¨ Uploading your painting...</p>
                        <div id="shareLinkContainer" style="display: none; margin-top: 10px;">
                            <input type="text" id="shareLink" readonly style="width: 100%; padding: 4px; font-size: 11px; border: 2px solid #808080; background: #fff;">
                            <button id="copyLinkBtn" class="modal-btn" style="margin-top: 8px; width: 100%;">Copy Link</button>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button id="shareModalClose" class="modal-btn modal-btn-primary">Close</button>
                    </div>
                </div>
            </div>
            <!-- Auth Modal -->
            <div id="authModal" class="modal">
                <div class="modal-content">
                    <div class="modal-body">
                        <p id="authStatus">Please sign in with Google to continue.</p>
                        <div id="authError" style="display: none; color: #d00; margin-top: 10px; font-size: 11px;"></div>
                        <div id="authUserInfo" style="display: none; margin-top: 10px;">
                            <p style="font-size: 11px;">Signed in as: <span id="authEmail"></span></p>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button id="authLoginBtn" class="modal-btn modal-btn-primary">Sign in with Google</button>
                        <button id="authLogoutBtn" class="modal-btn" style="display: none;">Sign Out</button>
                        <button id="authModalClose" class="modal-btn" style="display: none;">Close</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script src="script.js"></script>
</body>
</html>

